import sys
import re

if __name__ == '__main__':
    log_filename = sys.argv[1]
    with open(log_filename) as fp:
        line = fp.readline()
        while line and line[:-31] != "INFO: Spider closed (finished)\n":
            if 'pageno' in line:
                number = int(line.split('pageno=')[1][:-1])
                if number % 100 == 0:
                    print(number)
            if '[scrapy.core.scraper] ERROR' in line:
                filename = line[-19:-3]
                if not filename.startswith('CNNVD'):
                    filename = 'CNNVD' + '-' + '-'.join(filename.split('-')[1:])
                err_msg = line
                line = fp.readline()
                while line and 'INFO:' not in line and 'ERROR: Error processing' not in line:
                    err_msg += line
                    line = fp.readline()
                with open("err_logs/" + filename, 'w') as fw:
                    fw.write(err_msg)
            else:
                line = fp.readline()

    